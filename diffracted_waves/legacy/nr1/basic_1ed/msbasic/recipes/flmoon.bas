SUB FLMOON (N, NPH, JD&, FRAC)
RAD = .017453293#
C = N + NPH / 4!
T = C / 1236.85
T2 = T ^ 2
AQ = 359.2242 + 29.105356# * C
AM = 306.0253 + 385.816918# * C + .01073 * T2
JD& = 2415020 + 28 * N + 7 * NPH
XTRA = .75933 + 1.53058868# * C + (.0001178 - 1.55E-07 * T) * T2
IF NPH = 0 OR NPH = 2 THEN
  XTRA = XTRA + (.1734 - .000393 * T) * SIN(RAD * AQ) - .4068 * SIN(RAD * AM)
ELSEIF NPH = 1 OR NPH = 3 THEN
  XTRA = XTRA + (.1721 - .0004 * T) * SIN(RAD * AQ) - .628 * SIN(RAD * AM)
ELSE
  PRINT "NPH is unknown."
  EXIT SUB
END IF
IF XTRA >= 0! THEN
  I = INT(XTRA)
ELSE
  I = INT(XTRA - 1!)
END IF
JD& = JD& + I
FRAC = XTRA - I
END SUB

